<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Review Dashboard - GitLab MR & GitHub PR Review</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <!-- Left Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <rect width="32" height="32" rx="8" fill="#667eea"/>
                    <path d="M16 8L8 12V20L16 24L24 20V12L16 8Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M16 16L8 12M16 16L24 12M16 16V24" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="logo-text">Code Review</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-section="dashboard">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <rect x="3" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    <rect x="11" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    <rect x="3" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    <rect x="11" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                <span class="nav-text">Dashboard</span>
            </a>
            <a href="#new-review" class="nav-item" data-section="new-review">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M10 4v12m-6-6h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span class="nav-text">New Review</span>
            </a>
            <a href="#history" class="nav-item" data-section="history">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M10 6v4l3 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span class="nav-text">History</span>
            </a>
            <a href="#statistics" class="nav-item" data-section="statistics">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M4 16v-4m4 4V8m4 8V4m4 12v-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span class="nav-text">Statistics</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="db-status">
                <div class="status-dot" id="statusDot"></div>
                <div class="status-text">
                    <div class="status-label">Database</div>
                    <div class="status-value" id="mongoStatus">Checking...</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Top Header Bar -->
        <header class="top-header">
            <div class="header-left">
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
            </div>
            <div class="header-right">
                <div class="header-stats">
                    <div class="header-stat-item">
                        <span class="header-stat-label">Total Reviews</span>
                        <span class="header-stat-value" id="headerTotalReviews">0</span>
                    </div>
                    <div class="header-stat-item">
                        <span class="header-stat-label">Today</span>
                        <span class="header-stat-value" id="headerTodayReviews">0</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Section - Overview -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h2 class="section-title">Analytics Dashboard</h2>
                <p class="section-subtitle">Overview of all code reviews and insights</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid-main">
                <div class="stat-card-modern">
                    <div class="stat-card-header">
                        <div class="stat-icon-wrapper stat-icon-primary">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-label">Total Reviews</div>
                            <div class="stat-value" id="totalReviews">0</div>
                        </div>
                    </div>
                    <div class="stat-card-footer">
                        <span class="stat-trend stat-trend-up">‚Üó 12% from last week</span>
                    </div>
                </div>

                <div class="stat-card-modern">
                    <div class="stat-card-header">
                        <div class="stat-icon-wrapper stat-icon-success">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-label">Completed Today</div>
                            <div class="stat-value" id="recentReviews">0</div>
                        </div>
                    </div>
                    <div class="stat-card-footer">
                        <span class="stat-trend">Last 24 hours</span>
                    </div>
                </div>

                <div class="stat-card-modern">
                    <div class="stat-card-header">
                        <div class="stat-icon-wrapper stat-icon-warning">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-label">Avg DDD Score</div>
                            <div class="stat-value" id="avgDDDScore">0%</div>
                        </div>
                    </div>
                    <div class="stat-card-footer">
                        <span class="stat-trend stat-trend-up">‚Üó 5% improvement</span>
                    </div>
                </div>

                <div class="stat-card-modern">
                    <div class="stat-card-header">
                        <div class="stat-icon-wrapper stat-icon-info">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-label">Top Repository</div>
                            <div class="stat-value stat-value-small" id="topRepo">-</div>
                        </div>
                    </div>
                    <div class="stat-card-footer">
                        <span class="stat-trend">Most reviewed</span>
                    </div>
                </div>
            </div>

            <!-- Aggregate Charts Section -->
            <div class="charts-section">
                <h3>üìä Historical Analytics</h3>
                <div class="charts-grid">
                    <div class="chart-container">
                        <div id="dashReviewsOverTime"></div>
                    </div>
                    <div class="chart-container">
                        <div id="dashAvgScoresTrend"></div>
                    </div>
                    <div class="chart-container">
                        <div id="dashTopRepos"></div>
                    </div>
                    <div class="chart-container">
                        <div id="dashIssuesBreakdown"></div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="stats-card" style="margin-top: 24px;">
                <h3>üìã Recent Reviews</h3>
                <div id="dashboardRecentList" class="history-list">
                    <div class="loading-message">Loading recent reviews...</div>
                </div>
            </div>
        </section>

        <!-- New Review Section -->
        <section id="new-review" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Start New Code Review</h2>
                <p class="section-subtitle">Enter PR/MR details from any Git repository to begin comprehensive AI-powered analysis</p>
            </div>

            <div class="form-card">
                <div class="form-group">
                    <label for="prUrl" class="form-label">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 8px;">
                            <path d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"/>
                        </svg>
                        Merge Request / Pull Request URL
                    </label>
                    <input type="text" id="prUrl" class="form-input" placeholder="e.g., https://gitlab.com/owner/repo/-/merge_requests/123 or https://github.com/owner/repo/pull/456" />
                    <small class="form-hint">Supports GitLab, GitHub, Bitbucket, and other Git platforms</small>
                </div>
                <div class="form-group">
                    <label for="repoUrl" class="form-label">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 8px;">
                            <path d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"/>
                        </svg>
                        Source Repository URL
                    </label>
                    <input type="text" id="repoUrl" class="form-input" placeholder="e.g., https://gitlab.com/owner/repo or https://github.com/owner/repo" />
                    <small class="form-hint">Any Git repository URL from GitLab, GitHub, Bitbucket, etc.</small>
                </div>
                <button id="startReview" class="btn-primary">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" style="margin-right: 8px;">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                    </svg>
                    Start Review
                </button>
            </div>
        </section>

        <!-- Progress Section -->
        <section id="progressSection" class="progress-section-modern hidden">
            <div class="progress-header">
                <h3 class="progress-title">Review in Progress</h3>
                <div class="progress-stats">
                    <span class="progress-current">Step <span id="currentStep">0</span> of 10</span>
                    <span class="progress-percent"><span id="progressPercent">0</span>%</span>
                </div>
            </div>

            <!-- Professional Progress Bar -->
            <div class="progress-track">
                <div id="progressBar" class="progress-fill"></div>
            </div>

            <!-- Horizontal Step Timeline -->
            <div class="timeline-horizontal">
                <div class="timeline-step-horizontal" data-step="fetch">
                    <div class="step-marker-horizontal">
                        <div class="step-number">1</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">Fetch MR/PR</div>
                    <div class="step-connector"></div>
                </div>

                <div class="timeline-step-horizontal" data-step="clone">
                    <div class="step-marker-horizontal">
                        <div class="step-number">2</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">Clone Repo</div>
                    <div class="step-connector"></div>
                </div>

                <div class="timeline-step-horizontal" data-step="analyze">
                    <div class="step-marker-horizontal">
                        <div class="step-number">3</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">Analyze</div>
                    <div class="step-connector"></div>
                </div>

                <div class="timeline-step-horizontal" data-step="security">
                    <div class="step-marker-horizontal">
                        <div class="step-number">4</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">Security</div>
                    <div class="step-connector"></div>
                </div>

                <div class="timeline-step-horizontal" data-step="bugs">
                    <div class="step-marker-horizontal">
                        <div class="step-number">5</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">Bug Check</div>
                    <div class="step-connector"></div>
                </div>

                <div class="timeline-step-horizontal" data-step="style">
                    <div class="step-marker-horizontal">
                        <div class="step-number">6</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">Style</div>
                    <div class="step-connector"></div>
                </div>

                <div class="timeline-step-horizontal" data-step="tests">
                    <div class="step-marker-horizontal">
                        <div class="step-number">7</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">Tests</div>
                    <div class="step-connector"></div>
                </div>

                <div class="timeline-step-horizontal" data-step="ddd">
                    <div class="step-marker-horizontal">
                        <div class="step-number">8</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">DDD</div>
                    <div class="step-connector"></div>
                </div>

                <div class="timeline-step-horizontal" data-step="complexity">
                    <div class="step-marker-horizontal">
                        <div class="step-number">9</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">Complexity</div>
                    <div class="step-connector"></div>
                </div>

                <div class="timeline-step-horizontal" data-step="final">
                    <div class="step-marker-horizontal">
                        <div class="step-number">10</div>
                        <div class="step-pulse-horizontal"></div>
                    </div>
                    <div class="step-label">Finalize</div>
                </div>
            </div>
        </section>

        <!-- Summary Dashboard -->
        <section id="summarySection" class="summary-section hidden">
            <h2>üìä Review Summary</h2>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">üìÅ</div>
                    <div class="metric-value" id="totalFiles">0</div>
                    <div class="metric-label">Total Files</div>
                </div>
                <div class="metric-card clickable-metric" data-tab="tests" title="Click to view test suggestions">
                    <div class="metric-icon">üß™</div>
                    <div class="metric-value" id="testFiles">0</div>
                    <div class="metric-label">Test Files</div>
                    <div class="metric-action-hint">View tests ‚Üí</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üèóÔ∏è</div>
                    <div class="metric-value" id="dddScore">0%</div>
                    <div class="metric-label">DDD Score</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üìÇ</div>
                    <div class="metric-value" id="directories">0</div>
                    <div class="metric-label">Directories</div>
                </div>
            </div>

            <div class="summary-cards">
                <div class="summary-card clickable-card" data-tab="security">
                    <h3>üîí Security</h3>
                    <p id="securitySummary">No issues found</p>
                    <div class="card-action-hint">Click to view details ‚Üí</div>
                </div>
                <div class="summary-card clickable-card" data-tab="bugs">
                    <h3>üêõ Bugs</h3>
                    <p id="bugSummary">No issues found</p>
                    <div class="card-action-hint">Click to view details ‚Üí</div>
                </div>
                <div class="summary-card clickable-card" data-tab="quality">
                    <h3>‚ú® Code Quality</h3>
                    <p id="qualitySummary">No issues found</p>
                    <div class="card-action-hint">Click to view details ‚Üí</div>
                </div>
                <div class="summary-card clickable-card" data-tab="tests">
                    <h3>üß™ Test Suggestions</h3>
                    <p id="testSuggestionsSummary">No issues found</p>
                    <div class="card-action-hint">Click to view details ‚Üí</div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="charts-section">
                <h3>Visual Analysis</h3>
                <div class="charts-grid">
                    <div class="chart-container">
                        <div id="testChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="dddChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="extensionsChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="changesChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="testRatioChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="dddRadarChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="fileSizesChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="timelineChart"></div>
                    </div>
                </div>
            </div>

            <!-- Detailed Reports -->
            <div class="detailed-reports">
                <h3>Detailed Reports</h3>
                <div class="tabs">
                    <button class="tab-button active" data-tab="security">üîí Security</button>
                    <button class="tab-button" data-tab="bugs">üêõ Bugs</button>
                    <button class="tab-button" data-tab="quality">‚ú® Quality</button>
                    <button class="tab-button" data-tab="tests">üß™ Tests</button>
                </div>
                <div class="tab-content">
                    <div id="securityTab" class="tab-pane active">
                        <pre id="securityDetails"></pre>
                    </div>
                    <div id="bugsTab" class="tab-pane">
                        <pre id="bugsDetails"></pre>
                    </div>
                    <div id="qualityTab" class="tab-pane">
                        <pre id="qualityDetails"></pre>
                    </div>
                    <div id="testsTab" class="tab-pane">
                        <pre id="testsDetails"></pre>
                    </div>
                </div>
            </div>

            <!-- Download Section -->
            <div class="download-section">
                <h3>Download Reports</h3>
                <div class="download-buttons">
                    <button onclick="app.downloadReport('markdown')" class="download-btn">
                        üìÑ Download Markdown
                    </button>
                    <button onclick="app.downloadReport('json')" class="download-btn">
                        üìã Download JSON
                    </button>
                </div>
            </div>
        </section>

        <!-- History Section -->
        <section id="history" class="content-section history-section">
            <div class="section-header">
                <h2 class="section-title">Review History</h2>
                <p class="section-subtitle">View past code review sessions</p>
            </div>
            <div class="history-controls">
                <button onclick="app.loadHistory()" class="refresh-btn">üîÑ Refresh</button>
                <select id="historyLimit" class="limit-select" onchange="app.loadHistory()">
                    <option value="10">Last 10</option>
                    <option value="25">Last 25</option>
                    <option value="50">Last 50</option>
                </select>
            </div>
            <div id="historyList" class="history-list">
                <div class="loading-message">Loading history...</div>
            </div>
        </section>

        <!-- Statistics Section -->
        <section id="statistics" class="content-section statistics-section">
            <div class="section-header">
                <h2 class="section-title">Statistics Dashboard</h2>
                <p class="section-subtitle">Analytics and insights from your reviews</p>
            </div>
            <div class="stats-grid">
                <div class="stats-card">
                    <h3>üóÉÔ∏è Database Statistics</h3>
                    <div class="stats-content" id="dbStats">
                        <div class="stats-item">
                            <span class="stats-label">Total Sessions:</span>
                            <span class="stats-value" id="statTotalSessions">0</span>
                        </div>
                        <div class="stats-item">
                            <span class="stats-label">MongoDB Status:</span>
                            <span class="stats-value" id="statMongoStatus">Checking...</span>
                        </div>
                    </div>
                </div>
                <div class="stats-card">
                    <h3>üìÇ Top Reviewed Repositories</h3>
                    <div id="topReposList" class="top-repos-list">
                        <div class="loading-message">Loading statistics...</div>
                    </div>
                </div>
            </div>

            <!-- Repository Filter Section -->
            <div class="stats-card" style="margin-top: 24px;">
                <h3>üîç Filter Reports by Repository</h3>
                <div class="repo-filter-controls">
                    <select id="repoFilter" class="repo-filter-select">
                        <option value="">Select a repository...</option>
                    </select>
                    <button onclick="app.filterByRepository()" class="btn-primary" style="padding: 10px 20px;">
                        Filter Reports
                    </button>
                    <button onclick="app.clearRepoFilter()" class="btn-secondary" style="padding: 10px 20px;">
                        Clear Filter
                    </button>
                </div>
                <div id="filteredRepoStats" class="filtered-stats" style="display: none; margin-top: 20px;">
                    <div class="stats-summary">
                        <div class="stat-box">
                            <div class="stat-number" id="repoTotalReviews">0</div>
                            <div class="stat-label">Total Reviews</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="repoAvgDDD">0%</div>
                            <div class="stat-label">Avg DDD Score</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="repoAvgTests">0</div>
                            <div class="stat-label">Avg Tests</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="repoAvgFiles">0</div>
                            <div class="stat-label">Avg Files</div>
                        </div>
                    </div>
                </div>
                <div id="filteredReportsList" class="history-list" style="margin-top: 20px; display: none;">
                    <div class="loading-message">No reports to display</div>
                </div>
            </div>
        </section>
    </main>

    <script src="/static/app.js"></script>
</body>
</html>
